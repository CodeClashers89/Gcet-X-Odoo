{% extends 'base.html' %}

{% block title %}Two-Factor Authentication - Rental ERP{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 40px auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h1 style="color: #2c3e50; margin-bottom: 10px;">üîê Two-Factor Authentication</h1>
    <p style="color: #6c757d; margin-bottom: 30px;">
        Manage your 2FA settings and backup codes
    </p>

    <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin-bottom: 20px;">
        <h2 style="font-size: 16px; color: #2e7d32; margin-bottom: 5px;">‚úì 2FA is Enabled</h2>
        <p style="color: #2e7d32; margin: 0; font-size: 14px;">
            Your account is protected with Two-Factor Authentication
        </p>
    </div>

    <!-- Backup Codes Section -->
    <div style="margin-bottom: 30px;">
        <h3 style="font-size: 16px; margin-bottom: 15px;">Backup Codes</h3>
        
        {% if show_codes %}
        <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
            <p style="color: #856404; margin: 0 0 15px 0; font-size: 14px;">
                <strong>‚ö†Ô∏è Save these codes securely!</strong> Each code can only be used once.
            </p>
            <div style="background: white; padding: 15px; border-radius: 4px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                {% for code in backup_codes %}
                <code style="background: #f8f9fa; padding: 8px 12px; border-radius: 3px; font-size: 13px; font-family: monospace;">
                    {{ code }}
                </code>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
            <p style="color: #666; margin: 0 0 10px 0;">
                You have <strong>{{ backup_codes_count }}</strong> backup code(s) remaining.
            </p>
            <p style="color: #666; margin: 0; font-size: 13px;">
                Backup codes can be used to access your account if you lose your authenticator device.
            </p>
        </div>
        {% endif %}

        <form method="POST" style="margin-bottom: 20px;">
            {% csrf_token %}
            <input type="hidden" name="action" value="regenerate_codes">
            <button type="submit" class="btn btn-secondary">
                Generate New Backup Codes
            </button>
        </form>
    </div>

    <!-- Disable 2FA Section -->
    <div style="border-top: 1px solid #dee2e6; padding-top: 30px;">
        <h3 style="font-size: 16px; margin-bottom: 15px; color: #dc3545;">Disable 2FA</h3>
        
        <div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 20px; margin-bottom: 20px;">
            <p style="color: #721c24; margin: 0; font-size: 14px;">
                <strong>Warning:</strong> Disabling 2FA will make your account less secure. 
                You'll only need your password to login.
            </p>
        </div>

        <form method="POST" onsubmit="return confirm('Are you sure you want to disable Two-Factor Authentication? This will make your account less secure.');">
            {% csrf_token %}
            <input type="hidden" name="action" value="disable">
            
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="password" style="display: block; margin-bottom: 8px; font-weight: 500;">
                    Confirm with your password:
                </label>
                <input 
                    type="password" 
                    id="password"
                    name="password"
                    class="form-control"
                    required
                    placeholder="Enter your password"
                >
            </div>

            <button type="submit" class="btn btn-danger">
                Disable Two-Factor Authentication
            </button>
        </form>
    </div>

    <div style="margin-top: 30px;">
        <a href="{% url 'accounts:profile' %}" class="btn btn-secondary">‚Üê Back to Profile</a>
    </div>
</div>
{% endblock %}
